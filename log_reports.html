<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸš¨ ì‹¤ì‹œê°„ ì‹ ê³  ë¡œê·¸</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
        <h3 class="navbar-brand mb-2">ğŸ§¾ ë¡œê·¸ ëŒ€ì‹œë³´ë“œ</h3>
        <div class="ms-auto">
            <a href="/admin" class="btn btn-secondary btn-sm">â† ê´€ë¦¬ì í™ˆìœ¼ë¡œ</a>
        </div>
    </nav>

    <div class="container mt-5">
        <h3 class="mb-4">ğŸš¨ ì‹¤ì‹œê°„ ì‹ ê³  ë¡œê·¸</h3>
        {% if session.is_superadmin %}
        <form method="POST" action="/admin/logs/reports/delete_all" onsubmit="return confirm('ì •ë§ ì „ì²´ ì‚­ì œí• ê¹Œìš”?');" class="mb-3">
            <button class="btn btn-danger btn-sm">ğŸ§¹ ì „ì²´ ì‹ ê³  ë¡œê·¸ ì‚­ì œ</button>
        </form>
        {% endif %}

        <div class="list-group mb-4">
            <a href="/admin/logs" class="list-group-item list-group-item-action">ğŸ‘‘ ì‹¤ì‹œê°„ ê´€ë¦¬ì ë¡œê·¸</a>
            <a href="/admin/logs/chat" class="list-group-item list-group-item-action">ğŸ“© ì‹¤ì‹œê°„ ì±„íŒ… ë¡œê·¸</a>
            <a href="/admin/logs/items" class="list-group-item list-group-item-action">ğŸ“¦ ì‹¤ì‹œê°„ ê²Œì‹œë¬¼ ì‘ì—… ë¡œê·¸</a>
        </div>

        <ul class="list-group" id="report-log-list"> <!-- ì‹ ê³  ë¡œê·¸ë¥¼ ì¶”ê°€í•  ì •í™•í•œ ìš”ì†Œ ì§€ì • -->
            {% for log in logs %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <strong>ì‹ ê³ ì : </strong>{{ log.reporter_name }}<br>
                    <strong>ì‹ ê³  ì‚¬ìœ : </strong>{{ log.reason or 'ì‚¬ìœ  ì—†ìŒ' }}<br>
                    <strong>ì‹ ê³ ëœ ê²Œì‹œë¬¼: </strong>{{ log.reported_item_title or 'ì œëª© ì—†ìŒ' }}<br>
                    <strong>ê²Œì‹œë¬¼ ì‘ì„±ì ID: </strong>{{ log.reported_item_user_id or 'ID ì—†ìŒ' }} <br>
                </div>
                <div class="text-end">
                    <small class="text-muted">{{ log.timestamp }}</small>
                    <form method="POST" action="{{ url_for('delete_reports_log', log_id=log.id) }}" class="d-inline" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                        <button class="btn btn-sm btn-outline-danger">ğŸ—‘ ì‚­ì œ</button>
                    </form>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>

    <div class="container mt-5"></div>

    <script>
        const socket = io('/admin');

        socket.on('connect', () => {
            console.log("ğŸš¨ ì‹ ê³  ë¡œê·¸ ì†Œì¼“ ì—°ê²°ë¨");
        });

        socket.on('new_log', function(data) {
            // ë¡œê·¸ íƒ€ì…ì´ 'report'ì¼ ê²½ìš°ë§Œ ì¶”ê°€
            if (data.log_type === 'report') {
                const logList = document.getElementById("report-log-list");  // ì‹ ê³  ë¡œê·¸ ë¦¬ìŠ¤íŠ¸
                const li = document.createElement("li");
                const now = new Date().toLocaleString();

                li.className = "list-group-item";
                li.innerHTML = `
                    <strong>ì‹ ê³ ì : </strong>${data.reporter_name} <br>
                    <strong>ì‹ ê³  ì‚¬ìœ : </strong>${data.reason ? data.reason : 'ì‚¬ìœ  ì—†ìŒ'} <br>
                    <strong>ì‹ ê³ ëœ ê²Œì‹œë¬¼: </strong>${data.reported_item_title ? data.reported_item_title : 'ì œëª© ì—†ìŒ'}<br>
                    <strong>ê²Œì‹œë¬¼ ì‘ì„±ì ID: </strong>${data.reported_item_user_id ? data.reported_item_user_id : 'ID ì—†ìŒ'} <br>
                    <small class="text-muted float-end">${now}</small>
                `;
                
                // ë¦¬ìŠ¤íŠ¸ì˜ ì²« ë²ˆì§¸ í•­ëª©ìœ¼ë¡œ ìƒˆ ë¡œê·¸ ì¶”ê°€
                logList.prepend(li);
            }
        });
    </script>
</body>
</html>