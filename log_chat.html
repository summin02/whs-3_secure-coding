<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¡œê·¸ ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <!-- âœ… socket.ioëŠ” ì´ ì¤„ í•„ìˆ˜! -->
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
        <h3 class="navbar-brand mb-2">ğŸ§¾ ë¡œê·¸ ëŒ€ì‹œë³´ë“œ</h3>
        <div class="ms-auto">
            <a href="/admin" class="btn btn-secondary btn-sm">â† ê´€ë¦¬ì í™ˆìœ¼ë¡œ</a>
        </dev>
    </nav>

<div class="container mt-5">
    <h3 class="mb-4">ğŸ“© ì‹¤ì‹œê°„ ì±„íŒ… ë¡œê·¸</h3>
    {% if session.is_superadmin %}
    <!-- âœ… ìŠˆí¼ê´€ë¦¬ì ì „ìš© ì „ì²´ ì‚­ì œ ë²„íŠ¼ -->
    <form method="POST" action="/admin/logs/chat/delete_all" onsubmit="return confirm('ì •ë§ ì „ì²´ ì‚­ì œí• ê¹Œìš”?');" class="mb-3">
        <button class="btn btn-danger btn-sm">ğŸ§¹ ì „ì²´ ë¡œê·¸ ì‚­ì œ</button>
    </form>
    {% endif %}

    <div class="list-group mb-4">
        <a href="/admin/logs" class="list-group-item list-group-item-action"> ğŸ‘‘ ì‹¤ì‹œê°„ ê´€ë¦¬ì ë¡œê·¸</a>
        <a href="/admin/logs/items" class="list-group-item list-group-item-action">ğŸ“¦ ì‹¤ì‹œê°„ ê²Œì‹œë¬¼ ì‘ì—… ë¡œê·¸</a>
        <a href="/admin/logs/reports" class="list-group-item list-group-item-action">ğŸš¨ ì‹¤ì‹œê°„ ì‹ ê³  ë¡œê·¸</a>
    </div>

    <ul class="list-group" id="log-list">
        {% for log in logs %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
                <strong>ë³´ë‚¸ì‚¬ëŒ : </strong>{{ log.sender_name }}<br>
                <strong>ë°›ì€ì‚¬ëŒ : </strong>{{ log.receiver_name }}<br>
                <strong>ëŒ€í™”ë‚´ìš© : </strong>{{ log.content or "(ë‚´ìš© ì—†ìŒ)" }}
            </div>
            <div class="text-end">
                <small class="text-muted">{{ log.timestamp }}</small>
                <form method="POST" action="{{ url_for('delete_chat_log', log_id=log.id) }}" class="d-inline" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                    <button class="btn btn-sm btn-outline-danger">ğŸ—‘ ì‚­ì œ</button>
                </form>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>
<div class="container mt-5"></div>

<!-- âœ… ë°˜ë“œì‹œ ìœ„ì˜ socket.io.jsê°€ ë¨¼ì € ë¡œë“œëœ ì´í›„ì— ì•„ë˜ ì½”ë“œ ì‹¤í–‰ -->
<script>
    const socket = io('/admin');

    socket.on('connect', () => {
        console.log("âœ… log_chat ì†Œì¼“ ì—°ê²°ë¨");
    });

    socket.on('new_log', function(data) {
        const logList = document.getElementById("log-list");
        const li = document.createElement("li");
        const now = new Date().toLocaleString();

        li.className = "list-group-item";
        li.innerHTML = `<strong>[${data.log_type.toUpperCase()}]</strong> ${data.message}
                        <small class="text-muted float-end">${now}</small>`;
        logList.prepend(li);
    });
</script>
</body>
</html>