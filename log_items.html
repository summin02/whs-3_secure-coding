<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“¦ ê²Œì‹œë¬¼ ì‘ì—… ë¡œê·¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
        <h3 class="navbar-brand mb-2">ğŸ§¾ ë¡œê·¸ ëŒ€ì‹œë³´ë“œ</h3>
        <div class="ms-auto">
            <a href="/admin" class="btn btn-secondary btn-sm">â† ê´€ë¦¬ì í™ˆìœ¼ë¡œ</a>
        </div>
    </nav>

    <div class="container mt-5">
        <h3 class="mb-4">ğŸ“¦ ì‹¤ì‹œê°„ ê²Œì‹œë¬¼ ì‘ì—… ë¡œê·¸</h3>
        {% if session.is_superadmin %}
        <form method="POST" action="/admin/logs/items/delete_all" onsubmit="return confirm('ì •ë§ ì „ì²´ ì‚­ì œí• ê¹Œìš”?');" class="mb-3">
            <button class="btn btn-danger btn-sm">ğŸ§¹ ì „ì²´ ê²Œì‹œë¬¼ ë¡œê·¸ ì‚­ì œ</button>
        </form>
        {% endif %}

        <div class="list-group mb-4">
            <a href="/admin/logs" class="list-group-item list-group-item-action"> ğŸ‘‘ ì‹¤ì‹œê°„ ê´€ë¦¬ì ë¡œê·¸</a>
            <a href="/admin/logs/chat" class="list-group-item list-group-item-action">ğŸ“© ì‹¤ì‹œê°„ ì±„íŒ… ë¡œê·¸</a>
            <a href="/admin/logs/reports" class="list-group-item list-group-item-action">ğŸš¨ ì‹¤ì‹œê°„ ì‹ ê³  ë¡œê·¸</a>
        </div>

        <!-- IDë¥¼ ì„¤ì •í•˜ì—¬ ì •í™•í•œ ul ìš”ì†Œì— ë¡œê·¸ë¥¼ ì¶”ê°€ -->
        <ul class="list-group" id="item-log-list">
            {% for log in logs %}
            <li class="list-group-item">
                <div>
                    <strong>{{ log.nickname }}</strong> - {{ log.description }}
                </div>
                <div class="text-end">
                    <small class="text-muted">{{ log.timestamp }}</small>
                    <form method="POST" action="{{ url_for('delete_items_log', log_id=log.id) }}" class="d-inline" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                        <button class="btn btn-sm btn-outline-danger">ğŸ—‘ ì‚­ì œ</button>
                    </form>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>

    <div class="container mt-5"></div>

    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script>
        const socket = io('/admin');  // admin namespaceì— ì—°ê²°

        socket.on('connect', () => {
            console.log("ğŸ“¦ item ë¡œê·¸ ì†Œì¼“ ì—°ê²°ë¨");
        });

        // ì„œë²„ì—ì„œ ìƒˆ ë¡œê·¸ê°€ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ ì²˜ë¦¬
        socket.on('new_log', function(data) {
            if (data.log_type === 'item') {
                const logList = document.getElementById("item-log-list");  // ì •í™•í•œ ë¦¬ìŠ¤íŠ¸ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
                const li = document.createElement("li");
                const now = new Date().toLocaleString();

                li.className = "list-group-item";
                li.innerHTML = `<strong>[ITEM]</strong> ${data.message}
                                <small class="text-muted float-end">${now}</small>`;
                
                // ê¸°ì¡´ ë¡œê·¸ì˜ ë§¨ ë§ˆì§€ë§‰ì— ìƒˆë¡œìš´ ë¡œê·¸ë¥¼ ì¶”ê°€
                logList.prepend(li);
            }
        });
    </script>
</body>
</html>